- name: Checkout project repository
  become: yes
  become_user: "{{ server_user }}"
  git:
     repo: "{{item.repository}}"
     version: "{{ item.git_version | default('master')}}"
     dest: "{{ sites_path }}/{{ item.domain }}/{{ item.name }}"
     force: yes
     accept_hostkey: yes
  with_items: "{{ projects }}"
  when: 
    - item.repository
    - item.state == 'present'